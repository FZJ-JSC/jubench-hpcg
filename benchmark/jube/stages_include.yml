parameterset:
  name: sys_module_params
  # system definition
  parameter:
    - { name: system,   tag: jwb,  _: "JWB"  }
    - { name: system,   tag: jrdc, _: "JRDC" }

    - { name: sys_arch, tag: cpu+!cuda+!rocm, _: "" }
    - { name: sys_arch, tag: cuda+!cpu+!rocm, _: "UCX-settings/RC-CUDA" }
    - { name: sys_arch, tag: rocm+!cpu+!cuda, _: "Architecture/jureca_mi200 ROCm/5.4.0 UCX-settings/RC-ROCm" }

  # Stages
    - { name: stage,    tag: s22,  _: "2022" }
  # compiler
    - { name: GCC,   mode: python, _: '{"2022": "GCC/11.2.0"}["${stage}"]'   }
    - { name: Intel, mode: python, _: '{"2022": "Intel/2021.4"}["${stage}"]' }
  # MPI
    - { name: psmpi, mode: python, _: '{"2022": "ParaStationMPI/5.5.0-1"}["${stage}"]' }
    - { name: ompi,  mode: python, _: '{"2022": "OpenMPI/4.1.2"}["${stage}"]'          }
    - { name: impi,  mode: python, _: '{"2022": "IntelMPI/2021.4.0"}["${stage}"]'      }
  # CMAKE_CXX_COMPILER
    - { name: cxx_compiler, tag: go|gps,    mode: python, _: '{"2022": "g++"}["${stage}"]'  }
    - { name: cxx_compiler, tag: io|ips|ii, mode: python, _: '{"2022": "icpx"}["${stage}"]' }
  # combine stage, compiler and MPI
    - { name: go                                            }
    - { name: go,   tag: go,              _: "${stage}-go"  }
    - { name: gps                                           }
    - { name: gps,  tag: gps+!cuda+!rocm, _: "${stage}-gps" }
    - { name: io                                            }
    - { name: io,   tag: io+!cuda+!rocm,  _: "${stage}-io"  }
    - { name: ips                                           }
    - { name: ips,  tag: ips+!cuda+!rocm, _: "${stage}-ips" }
    - { name: ii                                            }
    - { name: ii,   tag: ii+!cuda+!rocm,  _: "${stage}-ii"  }

    - name: modules
      mode: python
      tag: s22
      _: '{"JWB": ",".join([i for i in "${go} ${gps} ${io} ${ips}".split(" ") if len(i) > 0]),
           "JRDC": ",".join([i for i in "${go} ${gps} ${io} ${ips} ${ii}".split(" ") if len(i) > 0])}["${system}"]'

    - name: load_stage
      mode: python
      _: '{"2022": "ml Stages/${stage}"}["${stage}"]'

    - name: load_modules
      mode: python
      _: '{"${stage}-go": "ml purge; ${load_stage}; ml ${GCC} ${ompi} ${sys_arch}",
           "${stage}-gps": "ml purge; ${load_stage}; ml ${GCC} ${psmpi}",
           "${stage}-io": "ml purge; ${load_stage}; ml ${Intel} ${ompi}",
           "${stage}-ips": "ml purge; ${load_stage}; ml ${Intel} ${psmpi}",
           "${stage}-ii": "ml purge; ${load_stage}; ml ${Intel} ${impi}"}.get("${modules}","No modules. EXIT!!")'
